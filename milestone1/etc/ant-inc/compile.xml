<?xml version="1.0"?>
<project name="celtix-compile" basedir="../..">
    <!-- Targets for compiling the codebase -->

    <!-- Load the codegen targets -->
    <import file="codegen.xml"/>
    
    
	<property name="xlint.args" value=":unchecked,deprecation,fallthrough,serial,finally"/>
	
    <!-- The entire codebase will be checkstyled automatically as part
    of the compile process.   If the code does not meet the style standards,
    the build will fail.    This is to make sure the code is more maintainable. -->
    <taskdef resource="checkstyletask.properties"
         classpath="${tools.dir}/checkstyle/4.0-beta5/checkstyle-all-4.0-beta5.jar"/>

    <target name="src.checkstyle" unless="no.checkstyle">
        <checkstyle config="${basedir}/etc/checkstyle.xml">
            <fileset dir="src" includes="**/*.java"/>
        </checkstyle>
    </target>
    <target name="unittest.checkstyle" unless="no.checkstyle">
        <checkstyle config="${basedir}/etc/checkstyle.xml">
            <fileset dir="${basedir}/test/unit" includes="**/*.java"/>
        </checkstyle>
    </target>
    <target name="systemtest.checkstyle" unless="no.checkstyle">
        <checkstyle config="${basedir}/etc/checkstyle.xml">
            <fileset dir="${basedir}/test/system" includes="**/*.java"/>
        </checkstyle>
    </target>
    <target name="checkstyle" depends="src.checkstyle,unittest.checkstyle,systemtest.checkstyle" description="Checkstyle the entire codebase"/>



    <!--  Targets to compile the code -->
    <!-- TODO: need to setup classpaths and such for the dependent libs -->
    <target name="src.compile" depends="src.checkstyle,schemas.codegen" description="Compile the source">
        <mkdir dir="${basedir}/build/classes"/>
    	<!--ObjectFactory objects are known to have an unchecked issue, don't run with -Xlint -->
        <javac
            destdir="${basedir}/build/classes"
            debug="true"
            target="1.5"
            source="1.5"
        	sourcepath=""
            fork="true"
			includeAntRuntime="false">
        	
            <src path="${basedir}/src"/>
            <src path="${basedir}/build/src"/>
			<include name="**/TExtensibilityElement*.java"/>

            <classpath>
                <path refid="src.compile.classpath"/>
            	<pathelement location="${basedir}/build/classes"/>
            </classpath>
        </javac>
        <javac
            destdir="${basedir}/build/classes"
            debug="true"
            target="1.5"
            source="1.5"
        	sourcepath=""
            fork="true"
			includeAntRuntime="false">
        	
            <src path="${basedir}/build/src"/>
			<include name="**/*.java"/>

            <classpath>
                <path refid="src.compile.classpath"/>
            	<pathelement location="${basedir}/build/classes"/>
            </classpath>
        </javac>
        <javac
            destdir="${basedir}/build/classes"
            debug="true"
            target="1.5"
            source="1.5"
            fork="true"
        	sourcepath=""
			includeAntRuntime="false">        	
        	<compilerarg line="-Xlint${xlint.args}"/>
        	
            <src path="${basedir}/src"/>
            <src path="${basedir}/build/src"/>
			<exclude name="**/ObjectFactory.java"/>
            <classpath>
                <path refid="src.compile.classpath"/>
            	<pathelement location="${basedir}/build/classes"/>
            </classpath>
        </javac>
    	<copy todir="${basedir}/build/classes">
    		<fileset dir="${basedir}/src" includes="**/*.properties"/>
    	</copy>
    </target>

    <target name="unittest.compile" depends="unittest.checkstyle,testwsdl.codegen" description="Compile the unit tests">
        <mkdir dir="${basedir}/build/classes-tests/unit"/>
        <javac srcdir="${basedir}/test/unit"
            destdir="${basedir}/build/classes-tests/unit"
            debug="true"
            target="1.5"
            source="1.5"
        	sourcepath=""
            fork="true">
        	<compilerarg value="-Xlint${xlint.args}"/>
            <classpath>
                <path refid="unit.test.compile.classpath"/>
            </classpath>
        </javac>
    	<copy todir="${basedir}/build/classes-tests/unit">
    		<fileset dir="${basedir}/test/unit" includes="**/resources/**/*"/>
    	</copy>
    	<copy todir="${basedir}/build/classes-tests/unit">
    		<fileset dir="${basedir}/etc" includes="logging.properties"/>
    	</copy>
    </target>

	   <target name="systest.compile" depends="systemtest.checkstyle,testwsdl.codegen" description="Compile the system tests">
	        <mkdir dir="${basedir}/build/classes-tests/system"/>
	        <javac srcdir="${basedir}/test/system"
	            destdir="${basedir}/build/classes-tests/system"
	            debug="true"
	            target="1.5"
	            source="1.5"
	        	sourcepath=""
	            fork="true">
	        	<compilerarg value="-Xlint${xlint.args}"/>
	            <classpath>
	                <path refid="system.test.compile.classpath"/>
	            </classpath>
	        </javac>
	    	<copy todir="${basedir}/build/classes-tests/system">
	    		<fileset dir="${basedir}/test/system" includes="**/resource/**/*"/>
	    	</copy>
	    	<copy todir="${basedir}/build/classes-tests/system">
	    		<fileset dir="${basedir}/etc" includes="logging.properties"/>
	    	</copy>
	    </target>	
</project>
