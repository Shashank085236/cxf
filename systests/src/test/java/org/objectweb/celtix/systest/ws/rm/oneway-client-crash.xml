<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans SYSTEM 
     "http://celtix.objectweb.org/configuration/spring/celtix-spring-beans.dtd">

<beans 
    xmlns:ct="http://celtix.objectweb.org/configuration/types"
    xmlns:wsrm-conf="http://celtix.objectweb.org/bus/configuration/wsrm"
    xmlns:http-conf="http://celtix.objectweb.org/transports/http/configuration"
    xmlns:jaxws-types="http://celtix.objectweb.org/bus/jaxws/configuration/types">
    
    <bean id="client-and-server" abstract="true">
        <property name="systemHandlerChain">
          <value>
              <jaxws-types:system-handler-chain>
                  <jaxws-types:preLogical>
                      <jaxws-types:handler>
                          <jaxws-types:handler-name>MAPAggregator</jaxws-types:handler-name>
                          <jaxws-types:handler-class>org.objectweb.celtix.ws.addressing.MAPAggregator</jaxws-types:handler-class>
                      </jaxws-types:handler>
                      <jaxws-types:handler>
                          <jaxws-types:handler-name>RMHandler</jaxws-types:handler-name>
                          <jaxws-types:handler-class>org.objectweb.celtix.ws.rm.RMHandler</jaxws-types:handler-class>
                      </jaxws-types:handler>
                      <jaxws-types:handler>
                          <jaxws-types:handler-name>LogicalMessageContextRecorder</jaxws-types:handler-name>
                          <jaxws-types:handler-class>org.objectweb.celtix.systest.ws.rm.LogicalMessageContextRecorder</jaxws-types:handler-class>
                      </jaxws-types:handler>                      
                  </jaxws-types:preLogical>
                  <jaxws-types:postLogical/>
                  <jaxws-types:preProtocol/>
                  <jaxws-types:postProtocol>
                  <jaxws-types:handler>
                          <jaxws-types:handler-name>RMSoapHandler</jaxws-types:handler-name>
                          <jaxws-types:handler-class>org.objectweb.celtix.ws.rm.soap.RMSoapHandler</jaxws-types:handler-class>
                      </jaxws-types:handler>
                      <jaxws-types:handler>
                          <jaxws-types:handler-name>MAPCodec</jaxws-types:handler-name>
                          <jaxws-types:handler-class>org.objectweb.celtix.ws.addressing.soap.MAPCodec</jaxws-types:handler-class>
                      </jaxws-types:handler>
                      <!--
                      <jaxws-types:handler>
                          <jaxws-types:handler-name>SOAPMessageRecorder</jaxws-types:handler-name>
                          <jaxws-types:handler-class>org.objectweb.celtix.systest.ws.rm.SOAPMessageRecorder</jaxws-types:handler-class>
                      </jaxws-types:handler>
                      -->
                      <jaxws-types:handler>
                          <jaxws-types:handler-name>RMPersistenceHandler</jaxws-types:handler-name>
                          <jaxws-types:handler-class>org.objectweb.celtix.ws.rm.soap.PersistenceHandler</jaxws-types:handler-class>
                      </jaxws-types:handler>
                  </jaxws-types:postProtocol>
              </jaxws-types:system-handler-chain>
          </value>
      </property>
      <property name="handlerChain">
          <value>
              <jaxws-types:handler-chain>
                  <jaxws-types:handler>
                      <jaxws-types:handler-name>SOAPMessageRecorder</jaxws-types:handler-name>
                      <jaxws-types:handler-class>org.objectweb.celtix.systest.ws.rm.SOAPMessageRecorder</jaxws-types:handler-class>
                  </jaxws-types:handler>
              </jaxws-types:handler-chain>
          </value>
      </property>
    </bean>
    
    <bean id="celtix.{http://celtix.objectweb.org/greeter_control}GreeterService"
        class="org.objectweb.celtix.bus.jaxws.endpoint_config.spring.EndpointConfigBean"
        parent="client-and-server">
    </bean>
    
    <bean id="celtix.{http://celtix.objectweb.org/greeter_control}GreeterService/GreeterPort"
        class="org.objectweb.celtix.bus.jaxws.port_config.spring.PortConfigBean"
        parent="client-and-server">
    </bean>
    
    <bean id="celtix.{http://celtix.objectweb.org/greeter_control}GreeterService/GreeterPort.http-client" 
        class="org.objectweb.celtix.bus.transports.http.http_client_config.spring.HttpClientConfigBean">    
        <property name="httpClient">
            <value>
                <http-conf:client DecoupledEndpoint="http://localhost:9999/decoupled_endpoint"/>
            </value>
        </property>
    </bean>
    
    <bean id="celtix.{http://celtix.objectweb.org/greeter_control}GreeterService/GreeterPort.rm-handler" 
        class="org.objectweb.celtix.bus.transports.http.http_client_config.spring.HttpClientConfigBean">    
        <property name="httpClient">
            <value>
                <http-conf:client DecoupledEndpoint="http://localhost:9999/decoupled_endpoint"/>
            </value>
        </property>
    </bean>
    
    <bean id="celtix.{http://celtix.objectweb.org/greeter_control}GreeterService/GreeterPort.rm-handler" 
        class="org.objectweb.celtix.bus.ws.rm.rm_config.spring.RmConfigBean">
        <property name="store">
            <value>
                <wsrm-conf:store>
                    <wsrm-conf:store-name>File based store</wsrm-conf:store-name>
                    <wsrm-conf:store-class>org.objectweb.celtix.ws.rm.persistence.jdbc.RMTxStore</wsrm-conf:store-class>
                    <wsrm-conf:init-param>
                        <wsrm-conf:param-name>org.objectweb.celtix.rm.persistence.jdbc.driver</wsrm-conf:param-name>
                        <wsrm-conf:param-value>org.apache.derby.jdbc.EmbeddedDriver</wsrm-conf:param-value>
                    </wsrm-conf:init-param>
                    <wsrm-conf:init-param>
                        <wsrm-conf:param-name>org.objectweb.celtix.rm.persistence.jdbc.url</wsrm-conf:param-name>
                        <wsrm-conf:param-value>jdbc:derby:rmpersist;create=true</wsrm-conf:param-value>
                    </wsrm-conf:init-param>
                </wsrm-conf:store>
            </value>
        </property> 
        <property name="sourcePolicies">
            <value>
                <wsrm-conf:sourcePolicy acksTo="http://localhost:9999/decoupled_endpoint">                        
                </wsrm-conf:sourcePolicy>
            </value>
        </property> 
    </bean>
    
    <bean id="celtix.{http://celtix.objectweb.org/greeter_control}GreeterService.wsa-handler" 
        class="org.objectweb.celtix.bus.ws.addressing.wsa_config.spring.WsaConfigBean"> 
        <property name="allowDuplicates" value="true"/>           
    </bean>
    
    <bean id="celtix.{http://celtix.objectweb.org/greeter_control}GreeterService/GreeterPort.wsa-handler" 
        class="org.objectweb.celtix.bus.ws.addressing.wsa_config.spring.WsaConfigBean"> 
        <property name="allowDuplicates" value="true"/>              
    </bean>
    
    

</beans>
